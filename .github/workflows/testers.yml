name: Testers

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  multiboot2:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: dependencies
        run: sudo apt-get --yes install crossbuild-essential-i386
      - name: autogen
        run: ./autogen.sh
      - name: configure
        run: ./configure --host='i386-elf' --enable-freestanding --with-libc-all --with-tester-multiboot2 AR="$(which i686-linux-gnu-ar)" CC="$(which i686-linux-gnu-gcc)" RANLIB="$(which i686-linux-gnu-ranlib)"
      - name: make
        run: make

  stivale2:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: dependencies
        run: sudo apt-get --yes install crossbuild-essential-i386
      - name: autogen
        run: ./autogen.sh
      - name: configure
        run: ./configure --host='x86_64-elf' --enable-freestanding --with-libc-all --with-tester-stivale2 AR="$(which x86_64-linux-gnu-ar)" CC="$(which x86_64-linux-gnu-gcc)" RANLIB="$(which x86_64-linux-gnu-ranlib)" CFLAGS='-mabi=sysv -mcmodel=kernel -mno-80387 -mno-red-zone'
      - name: make
        run: make
